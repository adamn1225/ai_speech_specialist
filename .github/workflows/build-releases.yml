name: Test Build

on:
  push:
    tags:
      - 'v*'

permissions:
  contents: write

jobs:
  test-build:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: Test Python
      run: |
        python --version
        python -c "print('✅ Python works')"
        
    - name: Install system dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y libegl1 libxkbcommon-x11-0 libxcb-icccm4 libxcb-image0 libxcb-keysyms1 libxcb-randr0 libxcb-render-util0 libxcb-xinerama0 libfontconfig1 libxrender1 libgl1-mesa-glx xvfb
        
    - name: Install PyQt6
      run: |
        python -m pip install --upgrade pip
        pip install PyQt6
        export QT_QPA_PLATFORM=offscreen
        export DISPLAY=:99
        python -c "from PyQt6.QtWidgets import QApplication; print('✅ PyQt6 works')"
        
    - name: Install PyInstaller
      run: |
        pip install pyinstaller
        pyinstaller --version
        
    - name: Test build
      run: |
        echo "Testing simple build..."
        export QT_QPA_PLATFORM=offscreen
        export DISPLAY=:99
        pyinstaller --onefile simple_main.py
        ls -la dist/
        
    - name: Create test file
      run: |
        echo "Test file content - Build successful!" > test-release.txt
        
    - name: Create Release
      uses: softprops/action-gh-release@v1
      with:
        files: test-release.txt
        body: |
          ## Test Release ${{ github.ref_name }}
          
          ✅ All build tests passed!
          
          This confirms:
          - Python 3.11 works
          - PyQt6 installs successfully  
          - PyInstaller can build executables
          - Release creation works
          
          Next step: Add actual executable files.
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
